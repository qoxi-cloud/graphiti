# Graphiti gRPC Server Configuration for Docker with FalkorDB
# This configuration is optimized for running with docker-compose-falkordb.yml

# gRPC Server Configuration
grpc:
  host: "0.0.0.0"
  port: 50051
  max_workers: 10
  enable_tls: ${GRPC_ENABLE_TLS:false}
  cert_path: ${GRPC_CERT_PATH:}
  key_path: ${GRPC_KEY_PATH:}
  enable_reflection: true

  # Compression
  compression:
    enabled: true
    algorithm: "gzip"
    level: 2

  # Timeouts (seconds, 0 = no timeout)
  timeouts:
    enabled: true
    default: 30
    services:
      IngestService:
        default: 120
        methods:
          AddEpisodeBulk: 600
          StreamEpisodes: 0
      RetrieveService:
        default: 30
        methods:
          StreamSearch: 0
          RetrieveEpisodes: 0
      AdminService:
        default: 60
        methods:
          BuildCommunities: 300
          ClearData: 120

  # Authentication
  auth:
    enabled: ${GRPC_AUTH_ENABLED:false}
    api_keys: ${GRPC_API_KEYS:[]}
    jwt_secret: ${GRPC_JWT_SECRET:}

  # Rate Limiting
  rate_limit:
    enabled: ${GRPC_RATE_LIMIT_ENABLED:false}
    max_requests: 1000

# LLM Configuration
llm:
  provider: "openai"
  model: "gpt-4o-mini"
  temperature: null
  max_tokens: 4096
  providers:
    openai:
      api_key: ${OPENAI_API_KEY}
      api_url: ${OPENAI_API_URL:https://api.openai.com/v1}
      organization_id: ${OPENAI_ORGANIZATION_ID:}
    azure_openai:
      api_key: ${AZURE_OPENAI_API_KEY:}
      api_url: ${AZURE_OPENAI_ENDPOINT:}
      api_version: ${AZURE_OPENAI_API_VERSION:2024-10-21}
      deployment_name: ${AZURE_OPENAI_DEPLOYMENT:}
      use_azure_ad: ${USE_AZURE_AD:false}
    anthropic:
      api_key: ${ANTHROPIC_API_KEY:}
      api_url: ${ANTHROPIC_API_URL:https://api.anthropic.com}
    gemini:
      api_key: ${GOOGLE_API_KEY:}
      project_id: ${GOOGLE_PROJECT_ID:}
      location: ${GOOGLE_LOCATION:us-central1}
    groq:
      api_key: ${GROQ_API_KEY:}
      api_url: ${GROQ_API_URL:https://api.groq.com/openai/v1}

# Embedder Configuration
embedder:
  provider: "openai"
  model: "text-embedding-3-small"
  dimensions: 1536
  providers:
    openai:
      api_key: ${OPENAI_API_KEY}
      api_url: ${OPENAI_API_URL:https://api.openai.com/v1}
      organization_id: ${OPENAI_ORGANIZATION_ID:}
    azure_openai:
      api_key: ${AZURE_OPENAI_API_KEY:}
      api_url: ${AZURE_OPENAI_EMBEDDINGS_ENDPOINT:}
      api_version: ${AZURE_OPENAI_API_VERSION:2024-10-21}
      deployment_name: ${AZURE_OPENAI_EMBEDDINGS_DEPLOYMENT:}
      use_azure_ad: ${USE_AZURE_AD:false}
    gemini:
      api_key: ${GOOGLE_API_KEY:}
      project_id: ${GOOGLE_PROJECT_ID:}
      location: ${GOOGLE_LOCATION:us-central1}
    voyage:
      api_key: ${VOYAGE_API_KEY:}
      api_url: ${VOYAGE_API_URL:https://api.voyageai.com/v1}
      model: "voyage-3"

# Database Configuration
database:
  provider: "falkordb"
  providers:
    falkordb:
      # Use environment variable if set, otherwise use Docker service hostname
      uri: ${FALKORDB_URI:redis://falkordb:6379}
      password: ${FALKORDB_PASSWORD:}
      database: ${FALKORDB_DATABASE:default_db}

# Graphiti Application Configuration
graphiti:
  group_id: ${GRAPHITI_GROUP_ID:main}
  episode_id_prefix: ${EPISODE_ID_PREFIX:}
  user_id: ${USER_ID:grpc_user}
  entity_types: []

# Server Options
destroy_graph: false
